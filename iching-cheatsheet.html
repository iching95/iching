<script>
    var url = "content";
    var dict = [];
    var loaded = 0
    
    const lineOrderNum = {
      pre:"初上用",
      post:"二三四五"
    };

    const ninesix = "九六";

    const replaces = Array(`${lineOrderNum.pre[0]}[${ninesix}]`,
    `[${ninesix}]${lineOrderNum.post[0]}`,
    `[${ninesix}]${lineOrderNum.post[1]}`,
    `[${ninesix}]${lineOrderNum.post[2]}`,
    `[${ninesix}]${lineOrderNum.post[3]}`,
    `${lineOrderNum.pre[1]}[${ninesix}]`,
    `${lineOrderNum.pre[2]}[${ninesix}]`);


    fetch('data.txt')
      .then(response => response.text())
      .then((data) => {
        rows = JSON.parse(data);
        Object.keys(rows).forEach(key => {
          fetch(url+"/"+key+'.txt')
          .then(response => response.text())
          .then((data) => {

            var content = data.split(/\r?\n/)
            var out = ""
            content.map((stmt,n) => {

              if((key == 1 || key == 2) && n > 17){
                return;
              }

              var line = "";
              var linebreak = stmt.search('#np') > 0;
              stmt = stmt.replace("#np","");

              let match = stmt.match(new RegExp(`^([${lineOrderNum.pre}]?[${ninesix}][${lineOrderNum.post}]?)(.+)$`,""))
            
              if(!match && n==0){
                match = stmt.match(/^(.+)(：.+)/);
              }

              var prefix      = match?match[1]:"";
              var stmtContent = match?match[2]:stmt;

              if(match){
                if(n==0){
                  prefix = `<strong class='line-prefix' >${prefix}</strong>`
                }else{
                  replaces.map((re,n)=>{
                  prefix = prefix.replace(new RegExp(`^(${re})`,"i"),`<strong class='line-prefix' class='markLine' id='line${n+1}' mark-data-id='line${n+1}'>$1</strong>`);
                  })
                }
              }

              stmtContent.split('').forEach(function(char) {
                if(!char.match(/[：。，！]/)){
                  line = line + "<c>" + char + "</c>"
                }else{
                  line = line + "" + char + ""
                }
              });

              line = prefix + "" + line + "";
              
              out = out + line;
              
            })

            dict[key] = out;
            if( ++loaded == 64){
              for(var j=1; j<=64;j++){
                document.write(dict[j])
              }
            }
          })

        });
      })


</script>
