<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Side A & B Generator</title>
    <style>

        .matrix {
            position: relative;
            margin:20px;
            min-width: 10px;
            min-height: 20px;        
        }

        .matrix:before, .matrix:after {
            content: "";
            position: absolute;
            top: 0;
            border: 1px solid #000;
            width: 6px;
            height: 100%;
        }
        .matrix:before {
            left: -6px;
            border-right: 0px;
        }
        .matrix:after {
            right: -6px;
            border-left: 0px;
        }
        .matrix td {
            padding: 5px;    
            text-align: center;
        }

        table {
            border-collapse: collapse;
            max-width: 400px;
        }
        table, th, td {
            text-align: center;
        }

        th, td {
            width: 50%;
        }

        button {
            margin: 5px;
            min-height: 30px;
        }

        body {
            text-align: left;
        }
    </style>
</head>

<body>

<button onclick="generateTable()">Generate Initial Side A & B</button>
<button onclick="applyRule3()">Apply Rule 3</button>
<button onclick="applyRule4a()">Apply Rule 4a</button>
<button onclick="applyRule4b()">Apply Rule 4b</button>
<button onclick="convertSides()">Convert Sides A & B (4>2, 1>3)</button>
<button onclick="getHexagramNames()">Get Names</button>

<table class="matrix">
    <tbody id="tableBody">
    </tbody>
</table>
<table>
    <tr>
        <td id="hexagramNameA"></td>
        <td id="hexagramNameB"></td>
    </tr>
</table>

<script>

    const BASE_URL = "https://ctext.org/book-of-changes/";

    const hexagrams = {
        "111111": {name: "qian", url: `${BASE_URL}qian/zh`},
        "000000": {name: "kun", url: `${BASE_URL}kun/zh`},
        "010001": {name: "zhun", url: `${BASE_URL}zhun/zh`},
        "100001": {name: "meng", url: `${BASE_URL}meng/zh`},
        "010101": {name: "xu", url: `${BASE_URL}xu/zh`},
        "110101": {name: "song", url: `${BASE_URL}song/zh`},
        "010010": {name: "shi", url: `${BASE_URL}shi/zh`},
        "110010": {name: "bi", url: `${BASE_URL}bi/zh`},
        "010011": {name: "xiao-xu", url: `${BASE_URL}xiao-xu/zh`},
        "110011": {name: "lu", url: `${BASE_URL}lu/zh`},
        "011001": {name: "tai", url: `${BASE_URL}tai/zh`},
        "111001": {name: "pi", url: `${BASE_URL}pi/zh`},
        "011101": {name: "tong-ren", url: `${BASE_URL}tong-ren/zh`},
        "111101": {name: "da-you", url: `${BASE_URL}da-you/zh`},
        "001101": {name: "qian1", url: `${BASE_URL}qian1/zh`},
        "101101": {name: "yu", url: `${BASE_URL}yu/zh`},
        "001111": {name: "sui", url: `${BASE_URL}sui/zh`},
        "101111": {name: "gu", url: `${BASE_URL}gu/zh`},
        "001011": {name: "lin", url: `${BASE_URL}lin/zh`},
        "101011": {name: "guan", url: `${BASE_URL}guan/zh`},
        "001001": {name: "shi-he", url: `${BASE_URL}shi-he/zh`},
        "101001": {name: "bi1", url: `${BASE_URL}bi1/zh`},
        "001110": {name: "bo", url: `${BASE_URL}bo/zh`},
        "101110": {name: "fu", url: `${BASE_URL}fu/zh`},
        "011110": {name: "wu-wang", url: `${BASE_URL}wu-wang/zh`},
        "111110": {name: "da-xu", url: `${BASE_URL}da-xu/zh`},
        "000101": {name: "yi", url: `${BASE_URL}yi/zh`},
        "100101": {name: "da-guo", url: `${BASE_URL}da-guo/zh`},
        "000111": {name: "kan", url: `${BASE_URL}kan/zh`},
        "100111": {name: "li", url: `${BASE_URL}li/zh`},
        "011011": {name: "xie", url: `${BASE_URL}xie/zh`},
        "111011": {name: "heng", url: `${BASE_URL}heng/zh`},
        "011010": {name: "du", url: `${BASE_URL}du/zh`},
        "111010": {name: "da-zhuang", url: `${BASE_URL}da-zhuang/zh`},
        "011000": {name: "jian", url: `${BASE_URL}jian/zh`},
        "111000": {name: "kui", url: `${BASE_URL}kui/zh`},
        "011111": {name: "jian1", url: `${BASE_URL}jian1/zh`},
        "111111": {name: "mei", url: `${BASE_URL}mei/zh`},
        "000010": {name: "feng", url: `${BASE_URL}feng/zh`},
        "100010": {name: "lv", url: `${BASE_URL}lv/zh`},
        "000011": {name: "dun", url: `${BASE_URL}dun/zh`},
        "100011": {name: "cui", url: `${BASE_URL}cui/zh`},
        "010100": {name: "guan1", url: `${BASE_URL}guan1/zh`},
        "110100": {name: "jia-ren", url: `${BASE_URL}jia-ren/zh`},
        "010110": {name: "kui1", url: `${BASE_URL}kui1/zh`},
        "110110": {name: "zhong-fu", url: `${BASE_URL}zhong-fu/zh`},
        "011100": {name: "xun", url: `${BASE_URL}xun/zh`},
        "111100": {name: "dui", url: `${BASE_URL}dui/zh`},
        "000001": {name: "huan", url: `${BASE_URL}huan/zh`},
        "100001": {name: "ji-ji", url: `${BASE_URL}ji-ji/zh`},
        "000100": {name: "wei-ji", url: `${BASE_URL}wei-ji/zh`},
        "100100": {name: "ge", url: `${BASE_URL}ge/zh`},
        "011101": {name: "kun1", url: `${BASE_URL}kun1/zh`},
        "111101": {name: "jing", url: `${BASE_URL}jing/zh`},
        "000110": {name: "ge1", url: `${BASE_URL}ge1/zh`},
        "100110": {name: "ding", url: `${BASE_URL}ding/zh`},
        "010000": {name: "zhen", url: `${BASE_URL}zhen/zh`},
        "110000": {name: "gen", url: `${BASE_URL}gen/zh`},
        "001000": {name: "kun2", url: `${BASE_URL}kun2/zh`},
        "101000": {name: "ming-yi", url: `${BASE_URL}ming-yi/zh`},
        "001010": {name: "jin", url: `${BASE_URL}jin/zh`},
        "101010": {name: "ming-xi", url: `${BASE_URL}ming-xi/zh`},
        "001100": {name: "jie", url: `${BASE_URL}jie/zh`},
        "101100": {name: "sun", url: `${BASE_URL}sun/zh`},
    };

    let sideA = [];
    let sideB = [];
    let backupSideA = [];
    let backupSideB = [];

    const urlParams = new URLSearchParams(window.location.search);
    const showCircles = urlParams.get('c') === '1';

    function generateRandomNumber() {
        return Math.floor(Math.random() * 4) + 1;
    }

    function numberToCircles(num) {
        if (!showCircles) return num;

        const circle = "â­—";
        return circle.repeat(num);
    }

    function generateTable() {
        sideA = Array.from({ length: 6 }, generateRandomNumber);
        sideB = Array.from({ length: 6 }, generateRandomNumber);
        backupSideA = [...sideA];
        backupSideB = [...sideB];
        document.getElementById("hexagramNameA").innerText = "";
        document.getElementById("hexagramNameB").innerText = "";
        updateTable();
    }

    function applyRule3() {
        for (let i = 0; i < 6; i++) {
            if (sideA[i] === 2 || sideA[i] === 3) {
                sideB[i] = sideA[i];
            }
        }
        updateTable();
    }

    function applyRule4a() {
        for (let i = 0; i < 6; i++) {
            if (sideA[i] === 1 && (sideB[i] === 2 || sideB[i] === 4)) {
                sideB[i] = 2;
            }
        }
        updateTable();
    }

    function applyRule4b() {
        for (let i = 0; i < 6; i++) {
            if (sideA[i] === 4 && (sideB[i] === 1 || sideB[i] === 3)) {
                sideB[i] = 3;
            }
        }
        updateTable();
    }

    function convertSides() {
        for (let i = 0; i < 6; i++) {
            if (sideA[i] === 4) sideA[i] = 2;
            if (sideA[i] === 1) sideA[i] = 3;
            if (sideB[i] === 4) sideB[i] = 2;
            if (sideB[i] === 1) sideB[i] = 3;
        }
        updateTable();
    }

    function getHexagramNames() {

      let binaryA = sideA.map(x => (x === 2 || x === 4) ? '0' : '1').join('');
      let binaryB = sideB.map(x => (x === 2 || x === 4) ? '0' : '1').join('');

        console.log(binaryA);
        console.log(binaryB);

        document.getElementById("hexagramNameA").innerHTML = `<a href="${hexagrams[binaryA].url}">${hexagrams[binaryA].name}</a>`;
        document.getElementById("hexagramNameB").innerHTML = `<a href="${hexagrams[binaryB].url}">${hexagrams[binaryB].name}</a>`;
    }

    function updateTable() {

        let tableRows = "";

        for (let i = 0; i < 6; i++) {
            let sideAColor = (sideA[i] !== backupSideA[i]) ? 'red' : 'black';
            let sideBColor = (sideB[i] !== backupSideB[i]) ? 'red' : 'black';

            tableRows += `<tr>
                <td style="color:${sideAColor}">${numberToCircles(sideA[i])}</td>
                <td style="color:${sideBColor}">${numberToCircles(sideB[i])}</td>
            </tr>`;
        }

        backupSideA = [...sideA];
        backupSideB = [...sideB];

        document.getElementById("tableBody").innerHTML = tableRows;
    }

</script>

</body>

</html>
