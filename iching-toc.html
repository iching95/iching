<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOC Viewer</title>
    <style>
        table {
            border-collapse: collapse;
            width: 25%;
            display: inline-table;
            margin-right: 1%;
        }
        
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        
        th:last-child, td:last-child {
            border-right: 1px solid black;
        }

    </style>
</head>

<body>

    <h2>Table of Contents</h2>
    <table id="tocBody"></table>

<script>
    window.onload = function() {


        const unitsPerRow = 4;  // Set this to configure how many units you want per row.

        fetch('data.txt')
        .then(response => response.json())
        .then(hexagrams => {
            fetch('pages.txt')
            .then(response => response.json())
            .then(pages => {
                let tocBody = document.getElementById('tocBody');
                let row;

                hexagramOrder.forEach((hex, index) => {
                    // Check if it's the start of a new set of units
                    if (index % unitsPerRow === 0) {
                        row = tocBody.insertRow();
                    }

                    // Create a new cell for the unit
                    let cell = row.insertCell();

                    // Use innerHTML to create a mini-table inside the cell for the hexagram and its books
                    let booksData = '';
                    for (let book in pages) {
                        const page = pages[book].page[hex.idx - 1] + pages[book].offset - pages[book].page[0];
                        booksData += `<tr><td>${book}</td><td>${page}</td></tr>`;
                    }

                    cell.innerHTML = `
                        <table class="unit">
                            <tr>
                                <td rowspan="${Object.keys(pages).length}" class="hexagram-index">${hex.idx}</td>
                                <td rowspan="${Object.keys(pages).length}" class="chinese-name">${hex.name}</td>
                            </tr>
                            ${booksData}
                        </table>
                    `;
                });

            })
            .catch(error => {
                console.error('There was an error!', error);
            });
        })
        .catch(error => {
            console.error('There was an error reading hexagrams!', error);
        });
    }

</script>

</body>
</html>